<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoTIFF Viewer with Location</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/openlayers/6.5.0/ol.min.css" />
    <style>
        #map { height: 100vh; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/openlayers/6.5.0/ol.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/geotiff@1.0.0-beta.6/dist/geotiff.browser.min.js"></script>
    <script>
        // Initialize the OpenLayers map
        const map = new ol.Map({
            target: 'map',
            view: new ol.View({
                center: ol.proj.fromLonLat([0, 0]),  // Set initial coordinates
                zoom: 2
            })
        });

        // Load the GeoTIFF (replace with your URL)
        async function loadGeoTIFF() {
            const tiff = await GeoTIFF.fromUrl('path_to_your_large_geotiff.tif');
            const image = await tiff.getImage();
            const bbox = image.getBoundingBox();

            // Using WebGL to render the image on the map
            const rasterSource = new ol.source.ImageStatic({
                url: '',
                imageExtent: ol.proj.transformExtent(bbox, 'EPSG:4326', 'EPSG:3857'),
                projection: 'EPSG:3857',
                interpolate: false
            });

            const rasterLayer = new ol.layer.Image({
                source: rasterSource
            });

            map.addLayer(rasterLayer);
            map.getView().fit(rasterSource.getExtent());
        }

        // Load the GeoTIFF when the page loads
        loadGeoTIFF();

        // Get user location and add it to the map
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const { latitude, longitude } = position.coords;
                const userLocation = ol.proj.fromLonLat([longitude, latitude]);

                const userMarker = new ol.Feature({
                    geometry: new ol.geom.Point(userLocation)
                });

                const vectorSource = new ol.source.Vector({
                    features: [userMarker]
                });

                const vectorLayer = new ol.layer.Vector({
                    source: vectorSource,
                    style: new ol.style.Style({
                        image: new ol.style.Circle({
                            radius: 6,
                            fill: new ol.style.Fill({ color: 'blue' }),
                            stroke: new ol.style.Stroke({ color: 'black', width: 2 })
                        })
                    })
                });

                map.addLayer(vectorLayer);
                map.getView().setCenter(userLocation);
                map.getView().setZoom(10);
            }, function() {
                alert('Geolocation not available');
            });
        }
    </script>
</body>
</html>
